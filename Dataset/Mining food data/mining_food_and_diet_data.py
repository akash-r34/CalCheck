# -*- coding: utf-8 -*-
"""Mining_food_and_diet_data.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1mcV011QxV2IEzDAT0ka3FDZJwlmhgVt9

#Step 1: Creating Dataset
Mining only the data of indian food items(using their FDCIDs) available in: https://fdc.nal.usda.gov/
"""

import json
import requests

fdcid_list = [2343829, 2343830, 2344617, 2343194, 2344618, 2344616, 2343195, 2345137, 2345138, 2342818,
              2342675, 2342680, 2342809, 2343139, 2341089, 2341103, 2341967, 2343193, 2343090, 2345911,
              2342675, 2342680, 2342809, 2343139, 2341089, 2341103, 2341967, 2343193, 2343090, 2345911,
              2343133, 2344673, 2342904, 2344473, 2341916, 2346076, 2345935, 2345988, 2342183, 2341493,
              2341858, 2341861, 2341852, 2341862, 2344240, 2344438, 2341504, 2342436, 2342435, 2342437,
              2343024, 2343886, 2343645, 2344437, 2345343, 2341636, 2345170, 2344634, 2345272, 2345652,
              2344234, 2344240, 2344242, 2344243, 2341156, 2342878, 2342877, 2342958, 2342335, 2342367, 2340907, 2340908, 2342361, 2342358,
              2344170, 2344126, 2344102, 2344159, 2344158, 2344143, 2344155, 2343843, 2343842, 2343841, 2345258, 2341894,
              2342427, 2344187, 2342905, 2341957, 2344436, 2344438, 2344440, 2344441, 2343090, 2344214, 2341702, 2341704, 2341699, 2341707, 2345425, 2345124, 2344239, 2345394,
              2345547, 2345539, 2345545, 2345651, 2345548, 2345551, 2345552, 2345549, 2344296, 2344431,
              2344795, 2344804, 2343374, 2343373, 2342026, 2343341, 2343343, 2343342, 2343892, 2344729,
              2344720, 2344695, 2341100, 2344665, 2344682, 2344719, 2345344, 2345765, 2345743, 2343882,
              2343427, 2343583, 2343596, 2343952, 2343566, 2344214, 2342906, 2345725, 2344698, 2345779, 2345094]
ind=0
headers = {'accept': 'application/json'}
data_arr = []
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)

  output_json = response.json()
  ind+=1
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[i][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']

"""##Step 2: Mining 10 items per code block to identify faulty api request(if any) with ease


> Note: This step can be skipped by just running the step 1 successfully


Each of these code block contains the same FDCIDs as the first block. The only difference is that the requests are sent 10 at a time. 
"""

fdcid_list = [2342675, 2342680, 2342809, 2343139, 2341089, 2341103, 2341967, 2343193, 2343090, 2345911]

headers = {'accept': 'application/json'}
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)
  output_json = response.json()
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[ind][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']
  ind+=1

fdcid_list = [2343133, 2344673, 2342904, 2344473, 2341916, 2346076, 2345935, 2345988, 2342183, 2341493]

headers = {'accept': 'application/json'}
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)
  output_json = response.json()
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[ind][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']
  ind+=1

fdcid_list = [2341858, 2341861, 2341852, 2341862, 2344240, 2344438, 2341504, 2342436, 2342435, 2342437]

headers = {'accept': 'application/json'}
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)
  output_json = response.json()
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[ind][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']
  ind+=1

fdcid_list = [2343024, 2343886, 2343645, 2344437, 2345343, 2341636, 2345170, 2344634, 2345272, 2345652]

headers = {'accept': 'application/json'}
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)
  output_json = response.json()
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[ind][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']
  ind+=1

fdcid_list = [2344234, 2344240, 2344242, 2344243, 2341156, 2342878, 2342877, 2342958, 2342335, 2342367, 2340907, 2340908, 2342361, 2342358]

headers = {'accept': 'application/json'}
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)
  output_json = response.json()
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[ind][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']
  ind+=1

fdcid_list = [2344170, 2344126, 2344102, 2344159, 2344158, 2344143, 2344155, 2343843, 2343842, 2343841, 2345258, 2341894]

headers = {'accept': 'application/json'}
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)
  output_json = response.json()
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[ind][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']
  ind+=1

fdcid_list = [2342427, 2344187, 2342905, 2341957, 2344436, 2344438, 2344440, 2344441, 2343090, 2344214, 2341702, 2341704, 2341699, 2341707, 2345425, 2345124, 2344239, 2345394]

headers = {'accept': 'application/json'}
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)
  output_json = response.json()
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[ind][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']
  ind+=1

"""Note: This block is an exception(contains more than 10 FDCIDs) as all of these FDCIDs requests were already checked for errors"""

fdcid_list = [2345547, 2345539, 2345545, 2345651, 2345548, 2345551, 2345552, 2345549, 2344296, 2344431,
              2344795, 2344804, 2343374, 2343373, 2342026, 2343341, 2343343, 2343342, 2343892, 2344729,
              2344720, 2344695, 2341100, 2344665, 2344682, 2344719, 2345344, 2345765, 2345743, 2343882,
              2343427, 2343583, 2343596, 2343952, 2343566, 2344214, 2342906, 2345725, 2344698, 2345779, 2345094]

headers = {'accept': 'application/json'}
for i, fdcid in enumerate(fdcid_list):
  url = 'https://api.nal.usda.gov/fdc/v1/food/'+str(fdcid)
  params = {'format': 'full', 
          'api_key': '3EOzG6fTmkUOQbhYpK0d0FWocwyAvKo4ty3RewDa'}

  response = requests.get(url, params=params, headers=headers)
  output_json = response.json()
  data_arr.append({'Food name': output_json['description']})
  for nutrient in output_json['foodNutrients']:
    data_arr[ind][nutrient['nutrient']['name'] + '(' + nutrient['nutrient']['unitName'] +')'] = nutrient['amount']
  ind+=1

"""#Step 3: Generating default Diets for the app
We create 6 different diets, each identified by 6 different unique dietIDs.

##Randomly generating dietIDs
Generate dietIDs in range from 1001 to 1006 for n(size of our food arrayy) times.
"""

import random

dietID = {'dietID': []}

for i in range(len(data_arr)):
  dietID['dietID'].append(random.randint(1001, 1006))
print(len(data_arr))
print(dietID)

"""##Assigning dietIDs
Assign the generated dietIDs to each food item and store them in a panda dataframe.
"""

import pandas as pd
from google.colab import data_table
data_table.enable_dataframe_formatter()
  
df1 = pd.DataFrame.from_dict(data_arr)
dietIDs = pd.DataFrame.from_dict(dietID)

result = pd.concat([dietIDs, df1], axis=1, join='inner')
  
result

"""#Step 4: Export the datasets

##Export the generated food dataset without dietIDs associated with them
"""

file_name = 'Food_data_generated.xlsx'
  
# saving the excel
df1.to_excel(file_name)
print('DataFrame is written to Excel File successfully.')

"""##Export the generated food dataset with dietIDs associated with them"""

file_name = 'Food_data_generated_with_dietIDs.xlsx'
  
# saving the excel
result.to_excel(file_name)
print('DataFrame is written to Excel File successfully.')